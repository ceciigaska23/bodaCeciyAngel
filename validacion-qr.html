<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Validaci√≥n de Asistencia - √Ångel & Ceci</title>

  <!-- Reutilizamos estilos -->
  <link rel="stylesheet" href="css/styles.css">
</head>
<body class="validation-page">
  <div class="validation-container">
    <h2>üé´ Validaci√≥n de Asistencia</h2>
    <div id="validationResult" class="validation-result">
      <p>‚è≥ Validando tu c√≥digo...</p>
    </div>
    <button onclick="window.location.href='/'" class="btn main-btn" style="margin-top: 20px;">
      Volver a la Invitaci√≥n
    </button>
  </div>

  <script>
    document.addEventListener("DOMContentLoaded", async () => {
      const params = new URLSearchParams(window.location.search);
      const code = params.get("code");
      const resultDiv = document.getElementById("validationResult");

      if (!code) {
        resultDiv.innerHTML = `<p class="error">‚ùå No se proporcion√≥ un c√≥digo de confirmaci√≥n.</p>`;
        return;
      }

      try {
        // üîó Llama a tu backend, que a su vez valida con Google Apps Script
        const response = await fetch(`/api/validate-code`, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ code })
        });

        const data = await response.json();

        if (data.isValid) {
          resultDiv.innerHTML = `
            <p class="success">‚úÖ C√≥digo v√°lido</p>
            <p><strong>${data.message}</strong></p>
          `;
        } else {
          resultDiv.innerHTML = `
            <p class="error">‚ùå C√≥digo inv√°lido o ya usado</p>
            <p>${data.message || 'Verifica con los novios'}</p>
          `;
        }
      } catch (err) {
        console.error(err);
        resultDiv.innerHTML = `<p class="error">‚ö†Ô∏è Error validando el c√≥digo. Intenta de nuevo.</p>`;
      }
    });
  </script>
</body>
</html>
